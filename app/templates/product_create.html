{% extends 'base.html' %}
{% import 'bootstrap/wtf.html' as wtf %}
{% import 'macros.html' as macros %}

{% block title %} 
    {{super()}} Registrar producto
{% endblock %}

{% block content %}
<div class="container">
    <form id="product_create_form" class="form form-horizontal" method="POST" role="form" action="/products/create" enctype="multipart/form-data" >
        <fieldset id="fieldsetmyFormControl" >
            <legend>{{title}}</legend>
            <!-- primer bloque: nombre, description, servings, instructions, imageURL -->
            <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                <div class="form-group">
                    <label for="inputImage" class="control-label">Imagen</label>
                    <div id="profile-container" >
                        <image id="profileImage" onclick="fasterPreview(this)" src="{{ url_for('static',  filename='assets/img/cupcake_recipe.png') }}" style="width:150px;height:150px;" />
                        <input id="imageUpload" onchange="fasterPreview(this)" type="file" name="profile_photo" placeholder="Photo" aria-filename="" aria-src="" value="" accept="image/*">
                    </div>
                    <input id="imageUpload__filename" hidden type="text" name="filename" aria-filename="" aria-src="" value="OLDNAME">
                    <input id="imageUpload__URL" hidden type="text" name="imageURL" aria-imageURL="" aria-src="" value="OLDimageURL">
                </div>
            </div>
            <div class="col-xs-12 col-sm-9 col-md-9 col-lg-9">
                <div class="form-group">
                    <label for="inputTitle" class="col-sm-4 control-label">Nombre del producto</label>
                    <div class="col-sm-8">
                        <input id="name" name="name" type="text" class="form-control"  placeholder="Nombre del producto " {% if form %} value="{{form.get('name')}}" {% endif %} required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputDescription" class="col-sm-4 control-label">Descripcion</label>
                    <div class="col-sm-8">
                        <input id="description" name="description" type="text" class="form-control"  placeholder="Descripcion del producto" {% if form %} value="{{form.get('description')}}" {% endif %} required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputServings" class="col-sm-4 control-label">Precio</label>
                    <div class="col-sm-8">
                        <input id="price" name="price" type="number" class="form-control"  placeholder="Precio del producto" step="1" min="1" {% if form %} value="{{form.get('price')}}" {% endif %} required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputTenant" class="col-sm-4 control-label">Vendedor</label>
                    <div class="col-sm-8">
                        <select name="vendor" class="form-control" id="vendor">
                            {% for i in vendors__list  %}  
                                {{macros.render_dropdown(i.get('name'))}}
                            {% endfor  %}
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="text-right">
                <button type="submit" class="btn btn-success" >Crear</button>
            </div>
            <br>
        </fieldset>   
        <!-- fin del fieldset  -->
    </form>
    <!-- fin del form -->
</div>

<!-- Scripts -->
<script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-storage.js"></script>

<script type='text/javascript'>
    document.getElementById("name").focus();
</script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDCLEJ3eFncL16rZaFP02-w4Eb_qqFmbSA",
        authDomain: "blogeekplatzi-2e74f.firebaseapp.com",
        databaseURL: "https://blogeekplatzi-2e74f.firebaseio.com",
        projectId: "blogeekplatzi-2e74f",
        storageBucket: "blogeekplatzi-2e74f.appspot.com",
        messagingSenderId: "669626757295",
        appId: "1:669626757295:web:c3ea2002a548b07fe4645a",
        measurementId: "G-0TLGQ6FHH4"
    };

    firebase.initializeApp(firebaseConfig);
    console.log("firebase config expose");

    function fasterPreview( uploader ) {
        if ( uploader.files && uploader.files[0] ){
            $('#profileImage').attr('src',window.URL.createObjectURL(uploader.files[0]) );
        }
        // document.querySelector("#imageUpload").src = "url"
        // document.getElementById('imageUpload__filename').value ="name"
        // document.getElementById('imageUpload__URL').value ="url"            
        uploadImage()
    }
    
    function uploadImage() {
        const ref       = firebase.storage().ref('recipes');
        const file      = document.querySelector("#imageUpload").files[0];
        const name      = +new Date() + "-"// + file.filename;
        const metadata  = { contentType: file.type };
        const task      = ref.child(name).put(file, metadata);
        
        task
            .then(snapshot => snapshot.ref.getDownloadURL())
                .then(url => {
                    console.log("ESTA ES LA URL")
                    console.log(url)
                    console.log(name)
                    document.querySelector("#imageUpload").src = url
                    document.getElementById('imageUpload__filename').value = name
                    document.getElementById('imageUpload__URL').value = url
                    //document.querySelector("#imageUpload").setAttribute('aria-filename',name)
                })
            .catch(console.error);
    }
</script>

    
{% endblock %}




