{% extends 'base.html' %}
{% import 'bootstrap/wtf.html' as wtf %}
{% import 'macros.html' as macros %}

{% block content %}

    <div class="container">
        <legend>{{title}}</legend>
        <form id="inventory_add_form" class="form form-horizontal" method="POST" role="form" action="/inventory/delete">
            <fieldset id="fieldsetmyFormControl" >
                <div class="form-group">
                    <label for="inputTenant" class="col-sm-4 control-label">Producto</label>
                    <div class="col-sm-8">
                        <select name="product" class="form-control" id="product" onchange="searchInfo(this)" required>
                            <option disabled selected value> -- elegir producto -- </option>
                            {{macros.render_dropdown_products(products__list)}}
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputAmount" class="col-sm-4 control-label">Cantidad a eliminar</label>
                    <div class="col-sm-8">
                        <input type="number" name="amount" class="form-control"  placeholder="Cantidad de recetas a eliminar" step="1" min="1" value="1" required>
                        <input hidden type="text" name="productID" id="productID" value="">
                    </div>
                </div>
                <div class="text-right">
                    <button type="submit" class="btn btn-success">Eliminar</button>
                </div>
            </fieldset>    
        </form>
        



        <br>
        <br>
        <hr>
        <div id="messageParent" class="panel panel-default" hidden>
            <div id="message" class="panel-heading">Panel de visualizacion de producto</div>
        </div>
        <div class="panel panel-default" id="panel" hidden>
            <div class="panel-heading" aria-roledescription="Panel de visualizacion de producto actual">Panel de visualizacion de producto actual</div>
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nombre</th>					
                        <th>Cantidad actual</th>		
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">#</th>
                        <td><div id="name"></div></td>
                        <td><div id="quantity"></div></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script type='text/javascript'>
        document.getElementById("product").focus();
    </script>

    <script>
        function searchInfo(option){
            let productID   = document.getElementById('productID')
            productID.value = option.value
            loadProduct(option.value)
        }
        function loadProduct(product) {
            var req = new XMLHttpRequest()
            req.onreadystatechange = function(){
                if (req.readyState == 4) {
                    if (req.status != 200) {
                        //error handling code here
                        console.log(req.responseText)
                        document.getElementById("messageParent").hidden = false
                        document.getElementById("message").innerHTML    = ""
                        document.getElementById("name").innerHTML       = ""
                        document.getElementById("quantity").innerHTML   = ""
                        // document.getElementById("unit")     = ""
                    }else{
                        let panel   = document.getElementById("panel")
                        let mParent = document.getElementById("messageParent")
                        let m       = document.getElementById("message")
                        let name    = document.getElementById("name")
                        let quantity= document.getElementById("quantity")
                        // let unit    = document.getElementById("unit")
                        // let total   = document.getElementById("total")

                        if (req.responseText ==null){
                            console.log(req.responseText)
                            m.innerHTML     = "No hay inventario para ese producto"
                            mParent.hidden  = false
                            panel.hidden    = true
                        }else{
                            console.log(req.responseText)
                            var pp      = JSON.parse(req.responseText)
                            var response= pp['response']
                            // console.log(response)

                            if ( response != 'NULL' ) {
                                m.innerHTML         = ""
                                mParent.hidden      = true
                                panel.hidden        = false
                                name.innerHTML      = response['name']
                                quantity.innerHTML  = response['quantity']
                                // unit.innerHTML      = response['unit']
                                // total.innerHTML     = response['total']
                            }else{
                                console.log("No hay inventario para ese producto")
                                m.innerHTML         = "No hay inventario para ese producto"
                                mParent.hidden      = false
                                panel.hidden        = true
                                name.innerHTML      = ""
                                quantity.innerHTML  = ""
                                // unit.innerHTML      = ""
                                // total.innerHTML     = ""
                            }
                        }
                    }
                }
            }
            req.open('GET', '/inventory/ajax/'+product)
            req.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
            req.send()
            
            return false
        }
    </script>
{% endblock %}




